[NPHIES Dynamic] Using existing mother patient: Sara Abbas Female (ID: 09d8cc5f-1b9e-4e75-bce4-d7b0aed24e83)
[NPHIES Dynamic] Building eligibility request bundle...
[NPHIES Dynamic] Newborn extension enabled
[NPHIES Dynamic] Sending request to NPHIES API...
[NPHIES] Sending eligibility request (attempt 1/3)
[NPHIES] Response received: 200
[NPHIES Dynamic] Parsing response and storing data...
Executed query {
  text: 'SELECT * FROM patients WHERE identifier = $1',
  duration: 5,
  rows: 1
}
Executed query {
  text: '\n' +
    '        UPDATE patients SET\n' +
    '          name = COALESCE($1, name),\n' +
    '          identifier_type = COALESCE($2, identifier_type),\n' +
    '          gender = COALESCE($3, gender),\n' +
    '          birth_date = COALESCE($4, birth_date),\n' +
    '          phone = COALESCE($5, phone),\n' +
    '          email = COALESCE($6, email),\n' +
    '          address = COALESCE($7, address),\n' +
    '          city = COALESCE($8, city),\n' +
    '          country = COALESCE($9, country),\n' +
    '          marital_status = COALESCE($10, marital_status),\n' +
    '          is_newborn = COALESCE($11, is_newborn),\n' +
    '          updated_at = NOW()\n' +
    '        WHERE identifier = $12\n' +
    '        RETURNING *\n' +
    '      ',
  duration: 19,
  rows: 1
}
[NPHIES Data] Updated patient: 100200
Executed query {
  text: 'SELECT * FROM insurers WHERE nphies_id = $1',
  duration: 2,
  rows: 1
}
Executed query {
  text: '\n' +
    '        UPDATE insurers SET\n' +
    '          insurer_name = COALESCE($1, insurer_name),\n' +
    '          status = COALESCE($2, status),\n' +
    '          phone = COALESCE($3, phone),\n' +
    '          email = COALESCE($4, email),\n' +
    '          address = COALESCE($5, address),\n' +
    '          updated_at = NOW()\n' +
    '        WHERE nphies_id = $6\n' +
    '        RETURNING *\n' +
    '      ',
  duration: 6,
  rows: 1
}
[NPHIES Data] Updated insurer: INS-FHIR
Executed query {
  text: 'SELECT * FROM patient_coverage WHERE (policy_number = $1 OR member_id = $1) AND patient_id = $2',
  duration: 4,
  rows: 1
}
Executed query {
  text: '\n' +
    '        UPDATE patient_coverage SET\n' +
    '          insurer_id = COALESCE($1, insurer_id),\n' +
    '          member_id = COALESCE($2, member_id),\n' +
    '          coverage_type = COALESCE($3, coverage_type),\n' +
    '          relationship = COALESCE($4, relationship),\n' +
    '          dependent_number = COALESCE($5, dependent_number),\n' +
    '          plan_name = COALESCE($6, plan_name),\n' +
    '          network_type = COALESCE($7, network_type),\n' +
    '          start_date = COALESCE($8, start_date),\n' +
    '          end_date = COALESCE($9, end_date),\n' +
    '          is_active = COALESCE($10, is_active),\n' +
    '          updated_at = NOW()\n' +
    '        WHERE coverage_id = $11\n' +
    '        RETURNING *\n' +
    '      ',
  duration: 6,
  rows: 1
}
[NPHIES Data] Updated coverage: 37069614
[NPHIES Data] Successfully processed response data
[NPHIES Dynamic] Storing eligibility result with mother_patient_id: 09d8cc5f-1b9e-4e75-bce4-d7b0aed24e83
[NPHIES Dynamic] Mother patient info: {
  finalMotherPatientId: '09d8cc5f-1b9e-4e75-bce4-d7b0aed24e83',
  motherPatientHasId: true,
  motherPatientId: '09d8cc5f-1b9e-4e75-bce4-d7b0aed24e83',
  motherPatientName: 'Sara Abbas Female',
  motherPatientIdentifier: '2000000003'
}
[NPHIES Data] Storing eligibility result with: {
  patient_id: 'cfb6809e-451b-4482-93ef-4aceec3d0ca6',
  mother_patient_id: '09d8cc5f-1b9e-4e75-bce4-d7b0aed24e83',
  has_motherPatient: true,
  motherPatient_patient_id: '09d8cc5f-1b9e-4e75-bce4-d7b0aed24e83',
  motherPatientId_param: '09d8cc5f-1b9e-4e75-bce4-d7b0aed24e83'
}
[NPHIES Data] Insert params for eligibility: {
  param5_mother_patient_id: '09d8cc5f-1b9e-4e75-bce4-d7b0aed24e83',
  allParams: [
    { index: 1, param: 'cfb6809e-451b-4482-93ef-4aceec3d0ca6' },
    { index: 2, param: 'b4ea317c-fb81-4957-afa6-5c8ad0c397ac' },
    { index: 3, param: '69912bb9-020e-42ac-839b-adb11efc18c0' },
    { index: 4, param: '487f79bb-e99f-454c-9ba9-c1d6b8c4e2da' },
    { index: 5, param: '09d8cc5f-1b9e-4e75-bce4-d7b0aed24e83' },
    { index: 6, param: 'benefits,validation' },
    { index: 7, param: '2025-12-26' },
    { index: 8, param: 'eligible' },
    { index: 9, param: 'complete' },
    { index: 10, param: true },
    { index: 11, param: '00fdecc4-523c-4c05-8d0f-d0bec56e363c' },
    { index: 12, param: 'a272bd17-16a6-4eac-8ae4-b52be8082e1b' },
    { index: 13, param: false },
    { index: 14, param: 'eligible' },
    { index: 15, param: 'string (8535 chars)' },
    { index: 16, param: 'string (29890 chars)' },
    { index: 17, param: 'string (13391 chars)' },
    { index: 18, param: 'string (2 chars)' }
  ]
}
Executed query {
  text: '\n' +
    '      INSERT INTO eligibility (\n' +
    '        patient_id, provider_id, insurer_id, coverage_id, mother_patient_id,\n' +
    '        purpose, serviced_date, status, outcome, inforce,\n' +
    '        nphies_request_id, nphies_response_id,\n' +
    '        is_transfer, site_eligibility,\n' +
    '        raw_request, raw_response, benefits, error_codes,\n' +
    '        request_date, response_date\n' +
    '      ) VALUES (\n' +
    '        $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, NOW(), NOW()\n' +
    '      )\n' +
    '      RETURNING eligibility_id\n' +
    '    ',
  duration: 21,
  rows: 1
}
Executed query {
  text: 'SELECT mother_patient_id FROM eligibility WHERE eligibility_id = $1',
  duration: 13,
  rows: 1
}
[NPHIES Data] Stored eligibility result: cf96d82f-b0f5-48da-8934-9a80619df402
[NPHIES Data] Verification - Expected mother_patient_id: 09d8cc5f-1b9e-4e75-bce4-d7b0aed24e83, Stored: 09d8cc5f-1b9e-4e75-bce4-d7b0aed24e83
[NPHIES Dynamic] Eligibility check completed. ID: cf96d82f-b0f5-48da-8934-9a80619df402
2025-12-26T01:15:13.306Z - GET /api/eligibility/cf96d82f-b0f5-48da-8934-9a80619df402/nphies-details - IP: ::1
Executed query {
  text: '\n' +
    '        SELECT \n' +
    '          e.*,\n' +
    '          e.mother_patient_id, -- Explicitly include mother_patient_id\n' +
    '          p.name as patient_name,\n' +
    '          p.identifier as patient_identifier,\n' +
    '          p.is_newborn as patient_is_newborn,\n' +
    '          pr.provider_name,\n' +
    '          pr.nphies_id as provider_nphies_id,\n' +
    '          i.insurer_name,\n' +
    '          i.nphies_id as insurer_nphies_id,\n' +
    '          pc.policy_number,\n' +
    '          pc.coverage_type\n' +
    '        FROM eligibility e\n' +
    '        LEFT JOIN patients p ON e.patient_id = p.patient_id\n' +
    '        LEFT JOIN providers pr ON e.provider_id = pr.provider_id\n' +
    '        LEFT JOIN insurers i ON e.insurer_id = i.insurer_id\n' +
    '        LEFT JOIN patient_coverage pc ON e.coverage_id = pc.coverage_id\n' +
    '        WHERE e.eligibility_id = $1\n' +
    '      ',
  duration: 16,
  rows: 1
}
2025-12-26T01:15:13.364Z - GET /api/eligibility/cf96d82f-b0f5-48da-8934-9a80619df402/nphies-details - IP: ::1
Executed query {
  text: '\n' +
    '        SELECT \n' +
    '          e.*,\n' +
    '          e.mother_patient_id, -- Explicitly include mother_patient_id\n' +
    '          p.name as patient_name,\n' +
    '          p.identifier as patient_identifier,\n' +
    '          p.is_newborn as patient_is_newborn,\n' +
    '          pr.provider_name,\n' +
    '          pr.nphies_id as provider_nphies_id,\n' +
    '          i.insurer_name,\n' +
    '          i.nphies_id as insurer_nphies_id,\n' +
    '          pc.policy_number,\n' +
    '          pc.coverage_type\n' +
    '        FROM eligibility e\n' +
    '        LEFT JOIN patients p ON e.patient_id = p.patient_id\n' +
    '        LEFT JOIN providers pr ON e.provider_id = pr.provider_id\n' +
    '        LEFT JOIN insurers i ON e.insurer_id = i.insurer_id\n' +
    '        LEFT JOIN patient_coverage pc ON e.coverage_id = pc.coverage_id\n' +
    '        WHERE e.eligibility_id = $1\n' +
    '      ',
  duration: 6,
  rows: 1
}
