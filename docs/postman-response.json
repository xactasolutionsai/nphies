{
    "resourceType": "Bundle",
    "id": "d7fa97e3-7554-4165-a1a9-dcb6931a6564",
    "meta": {
        "profile": [
            "http://nphies.sa/fhir/ksa/nphies-fs/StructureDefinition/bundle|1.0.0"
        ]
    },
    "type": "message",
    "timestamp": "2025-12-22T15:15:51.069+03:00",
    "entry": [
        {
            "fullUrl": "http://nphies.sa/MessageHeader/f621eb30-f869-422d-a6ac-07f6f0414bb7",
            "resource": {
                "resourceType": "MessageHeader",
                "id": "f621eb30-f869-422d-a6ac-07f6f0414bb7",
                "meta": {
                    "profile": [
                        "http://nphies.sa/fhir/ksa/nphies-fs/StructureDefinition/message-header|1.0.0"
                    ]
                },
                "eventCoding": {
                    "system": "http://nphies.sa/terminology/CodeSystem/ksa-message-events",
                    "code": "poll-response"
                },
                "destination": [
                    {
                        "endpoint": "http://provider.com/fhir",
                        "receiver": {
                            "type": "Organization",
                            "identifier": {
                                "system": "http://nphies.sa/license/provider-license",
                                "value": "1010613708"
                            }
                        }
                    }
                ],
                "sender": {
                    "type": "Organization",
                    "identifier": {
                        "system": "http://nphies.sa/license/nphies",
                        "value": "NPHIES"
                    }
                },
                "source": {
                    "endpoint": "http://nphies.sa/"
                },
                "response": {
                    "identifier": "3294e2c7-711b-425d-ba09-56422ea845ca",
                    "code": "fatal-error"
                }
            }
        },
        {
            "fullUrl": "http://nphies.sa/Task/406a8ee7-595b-40e6-9a72-7b8d6d544dc7",
            "resource": {
                "resourceType": "Task",
                "id": "406a8ee7-595b-40e6-9a72-7b8d6d544dc7",
                "meta": {
                    "profile": [
                        "http://nphies.sa/fhir/ksa/nphies-fs/StructureDefinition/poll-request|1.0.0"
                    ],
                    "tag": [
                        {
                            "code": "NPHIES generated",
                            "display": "NPHIES generated"
                        }
                    ]
                },
                "identifier": [
                    {
                        "value": "743"
                    }
                ],
                "status": "failed",
                "intent": "order",
                "code": {
                    "coding": [
                        {
                            "system": "http://nphies.sa/terminology/CodeSystem/task-code",
                            "code": "poll"
                        }
                    ]
                },
                "authoredOn": "2025-12-22T12:15:44.173Z",
                "requester": {
                    "reference": "Organization/provider-org-1766405744173"
                },
                "owner": {
                    "identifier": {
                        "system": "http://nphies.sa/license/nphies",
                        "value": "NPHIES"
                    }
                },
                "output": [
                    {
                        "type": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/ValueSet/task-output-type",
                                    "code": "error"
                                }
                            ]
                        },
                        "valueCodeableConcept": {
                            "coding": [
                                {
                                    "extension": [
                                        {
                                            "url": "http://nphies.sa/fhir/ksa/nphies-fs/StructureDefinition/extension-error-expression",
                                            "valueString": "Bundle.entry[0].resource.focus[0]"
                                        }
                                    ],
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        }
                    },
                    {
                        "type": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/ValueSet/task-output-type",
                                    "code": "error"
                                }
                            ]
                        },
                        "valueCodeableConcept": {
                            "coding": [
                                {
                                    "extension": [
                                        {
                                            "url": "http://nphies.sa/fhir/ksa/nphies-fs/StructureDefinition/extension-error-expression",
                                            "valueString": "Bundle.entry[1].resource"
                                        }
                                    ],
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00170",
                                    "display": "Referenced SHALL point to a valid profile"
                                }
                            ]
                        }
                    },
                    {
                        "type": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/ValueSet/task-output-type",
                                    "code": "error"
                                }
                            ]
                        },
                        "valueCodeableConcept": {
                            "coding": [
                                {
                                    "extension": [
                                        {
                                            "url": "http://nphies.sa/fhir/ksa/nphies-fs/StructureDefinition/extension-error-expression",
                                            "valueString": "Bundle.entry[2].resource.extension"
                                        }
                                    ],
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "IC-01428",
                                    "display": "The element SHALL follow the cardinality specified in the NPHIES profile"
                                }
                            ]
                        }
                    },
                    {
                        "type": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/ValueSet/task-output-type",
                                    "code": "error"
                                }
                            ]
                        },
                        "valueCodeableConcept": {
                            "coding": [
                                {
                                    "extension": [
                                        {
                                            "url": "http://nphies.sa/fhir/ksa/nphies-fs/StructureDefinition/extension-error-expression",
                                            "valueString": "Bundle.entry[2].resource.extension[0].providerType"
                                        }
                                    ],
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "IC-01574",
                                    "display": "'Organization ProviderType' is not following the specified cardinality within the message profile"
                                }
                            ]
                        }
                    }
                ]
            }
        },
        {
            "fullUrl": "urn:uuid:org-provider-001",
            "resource": {
                "resourceType": "Organization",
                "id": "provider-org-1766405744173",
                "meta": {
                    "profile": [
                        "http://nphies.sa/fhir/ksa/nphies-fs/StructureDefinition/provider-organization|1.0.0"
                    ]
                },
                "identifier": [
                    {
                        "system": "http://nphies.sa/license/provider-license",
                        "value": "1010613708"
                    }
                ],
                "active": true,
                "type": [
                    {
                        "coding": [
                            {
                                "system": "http://nphies.sa/terminology/CodeSystem/organization-type",
                                "code": "prov"
                            }
                        ]
                    }
                ],
                "name": "Saudi General Hospital"
            }
        },
        {
            "fullUrl": "urn:uuid:org-nphies",
            "resource": {
                "resourceType": "Organization",
                "id": "NPHIES",
                "meta": {
                    "profile": [
                        "http://nphies.sa/fhir/ksa/nphies-fs/StructureDefinition/organization|1.0.0"
                    ]
                },
                "identifier": [
                    {
                        "system": "http://nphies.sa/license/nphies",
                        "value": "NPHIES"
                    }
                ],
                "active": true,
                "name": "National Program for Health Information Exchange Services"
            }
        }
    ]
}