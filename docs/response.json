{
    "resourceType": "Bundle",
    "id": "a2e60d3a-b79a-4e60-9dd9-47755d730f65",
    "meta": {
        "profile": [
            "http://nphies.sa/fhir/ksa/nphies-fs/StructureDefinition/bundle|1.0.0"
        ]
    },
    "type": "message",
    "timestamp": "2025-12-28T19:21:23.272+00:00",
    "entry": [
        {
            "fullUrl": "http://nphies.sa/MessageHeader/5e8f1e22-1254-4073-b785-7bf5ceeff937",
            "resource": {
                "resourceType": "MessageHeader",
                "id": "5e8f1e22-1254-4073-b785-7bf5ceeff937",
                "eventCoding": {
                    "system": "http://nphies.sa/terminology/CodeSystem/ksa-message-events",
                    "code": "batch-response"
                },
                "destination": [
                    {
                        "endpoint": "http://provider.com",
                        "receiver": {
                            "type": "Organization",
                            "identifier": {
                                "system": "http://nphies.sa/license/provider-license",
                                "value": "1010613708"
                            }
                        }
                    }
                ],
                "sender": {
                    "type": "Organization",
                    "identifier": {
                        "system": "http://nphies.sa/license/nphies",
                        "value": "NPHIES"
                    }
                },
                "source": {
                    "endpoint": "http://nphies.sa/"
                },
                "response": {
                    "identifier": "e8ba9ba8-fe46-4ad9-8d30-2984f652e425",
                    "code": "fatal-error",
                    "details": {
                        "reference": "http://nphies.sa/OperationOutcome/8165b327-5bac-4519-a155-283c29b43c1d"
                    }
                }
            }
        },
        {
            "fullUrl": "http://nphies.sa/OperationOutcome/8165b327-5bac-4519-a155-283c29b43c1d",
            "resource": {
                "resourceType": "OperationOutcome",
                "id": "8165b327-5bac-4519-a155-283c29b43c1d",
                "meta": {
                    "profile": [
                        "http://nphies.sa/fhir/ksa/nphies-fs/StructureDefinition/operationoutcome|1.0.0"
                    ]
                },
                "issue": [
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[0].resource.focus[0]"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[0].resource.focus[1]"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[1].resource.extension[1].value"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[1].resource.patient"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[1].resource.insurer"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[1].resource.provider"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[1].resource.careTeam[0].provider"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[1].resource.insurance[0].coverage"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[2].resource.subject"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[2].resource.serviceProvider"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[3].resource.policyHolder"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[3].resource.subscriber"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[3].resource.beneficiary"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[3].resource.payor[0]"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "IB-00242",
                                    "display": "Code 'network' from system 'http://terminology.hl7.org/CodeSystem/coverage-class' does not exist in valueset 'http://hl7.org/fhir/ValueSet/coverage-class'"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[3].resource.class[1].type"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[1].resource.patient"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[1].resource.insurer"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[1].resource.provider"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[1].resource.careTeam[0].provider"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[1].resource.insurance[0].coverage"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[2].resource.policyHolder"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[2].resource.subscriber"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[2].resource.beneficiary"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[2].resource.payor[0]"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "IB-00242",
                                    "display": "Element value binding is not using a value from the specified ValueSet"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[2].resource.class[1].type"
                        ]
                    }
                ]
            }
        }
    ]
}