{
    "resourceType": "Bundle",
    "id": "693b6f42-4cae-46bd-81f2-499c7bbbe32e",
    "meta": {
        "profile": [
            "http://nphies.sa/fhir/ksa/nphies-fs/StructureDefinition/bundle|1.0.0"
        ]
    },
    "type": "message",
    "timestamp": "2025-12-28T20:00:35.922+00:00",
    "entry": [
        {
            "fullUrl": "http://nphies.sa/MessageHeader/66d37564-ff47-4d69-a235-e871259e0270",
            "resource": {
                "resourceType": "MessageHeader",
                "id": "66d37564-ff47-4d69-a235-e871259e0270",
                "eventCoding": {
                    "system": "http://nphies.sa/terminology/CodeSystem/ksa-message-events",
                    "code": "batch-response"
                },
                "destination": [
                    {
                        "endpoint": "http://provider.com",
                        "receiver": {
                            "type": "Organization",
                            "identifier": {
                                "system": "http://nphies.sa/license/provider-license",
                                "value": "1010613708"
                            }
                        }
                    }
                ],
                "sender": {
                    "type": "Organization",
                    "identifier": {
                        "system": "http://nphies.sa/license/nphies",
                        "value": "NPHIES"
                    }
                },
                "source": {
                    "endpoint": "http://nphies.sa/"
                },
                "response": {
                    "identifier": "256d6666-b01c-45cc-9163-793d3336cd43",
                    "code": "fatal-error",
                    "details": {
                        "reference": "http://nphies.sa/OperationOutcome/aa066be6-a6db-448d-bc84-e59e2c3608b8"
                    }
                }
            }
        },
        {
            "fullUrl": "http://nphies.sa/OperationOutcome/aa066be6-a6db-448d-bc84-e59e2c3608b8",
            "resource": {
                "resourceType": "OperationOutcome",
                "id": "aa066be6-a6db-448d-bc84-e59e2c3608b8",
                "meta": {
                    "profile": [
                        "http://nphies.sa/fhir/ksa/nphies-fs/StructureDefinition/operationoutcome|1.0.0"
                    ]
                },
                "issue": [
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[0].resource.focus[0]"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[0].resource.focus[1]"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[1].resource.extension[1].value"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[1].resource.patient"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[1].resource.insurer"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[1].resource.provider"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[1].resource.careTeam[0].provider"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[1].resource.insurance[0].coverage"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[2].resource.subject"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[2].resource.serviceProvider"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[3].resource.policyHolder"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[3].resource.subscriber"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[3].resource.beneficiary"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[1].resource.entry[3].resource.payor[0]"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[1].resource.patient"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[1].resource.insurer"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[1].resource.provider"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[1].resource.careTeam[0].provider"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[1].resource.insurance[0].coverage"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[2].resource.policyHolder"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[2].resource.subscriber"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[2].resource.beneficiary"
                        ]
                    },
                    {
                        "severity": "error",
                        "code": "business-rule",
                        "details": {
                            "coding": [
                                {
                                    "system": "http://nphies.sa/terminology/CodeSystem/adjudication-error",
                                    "code": "RE-00169",
                                    "display": "Reference processing is not referring to a valid resource"
                                }
                            ]
                        },
                        "expression": [
                            "Bundle.entry[2].resource.entry[2].resource.payor[0]"
                        ]
                    }
                ]
            }
        }
    ]
}